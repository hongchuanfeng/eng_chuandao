<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Online Image Compressor - Chandao Tools</title>
  <meta name="keywords" content="online tool collection, Chandao Tools">
  <meta name="description" content="Chandao Tools is a collection of free, no-login online utilities across life, dev, encoding/decoding, encryption, images, and fun.">
  <link rel="canonical" href="https://www.chdaoai.com/image/compress/index.html">  
  <link rel="icon" href="../../favicon.ico" type="image/x-icon"/>
  <link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon"/>
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="css.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    .nav {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      gap: 20px;
    }
    .nav-item {
      color: #666;
      text-decoration: none;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .input-area {
      width: 100%;
      height: 200px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      resize: vertical;
      font-family: monospace;
      margin-bottom: 15px;
      font-size: 14px;
    }
    .button-group {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }
    .convert-btn {
      background-color: #00c853;
      color: white;
    }
    .convert-btn:hover {
      background-color: #00b34a;
    }
    .clear-btn {
      background-color: #ff5252;
      color: white;
    }
    .clear-btn:hover {
      background-color: #ff1744;
    }
    .result-area {
      width: 100%;
      min-height: 200px;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      text-align: center;
    }
    .result-area img {
      max-width: 100%;
      max-height: 500px;
    }
    .info-box {
      margin-top: 20px;
      padding: 15px;
      background: #fff5f0;
      border-radius: 4px;
    }
    .info-title {
      color: #ff6b6b;
      margin-bottom: 10px;
    }
    .info-list {
      list-style: none;
      color: #666;
      font-size: 14px;
      line-height: 1.8;
    }
    .info-list li {
      margin-bottom: 5px;
      color: #ff6b6b;
    }
  </style>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: system-ui, -apple-system, sans-serif;
    }

    body {
      background-color: #f5f5f5;
    }

    /* ÂìçÂ∫îÂºèÂØºËà™Ê†è */
    nav {
      background: white;
      padding: 1rem 2rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: relative;
    }

    .nav-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-categories {
      display: flex;
      gap: 2rem;
      z-index: 999;
    }

    .nav-category {
      color: #666;
      cursor: pointer;
      transition: color 0.3s;
      white-space: nowrap;
      text-decoration: none;
    }

    .nav-category:hover {
      color: #007bff;
    }

    .menu-btn {
      display: none;
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
    }

    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    /* Â∑•ÂÖ∑Âç°ÁâáÂ∏ÉÂ±Ä */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      padding: 1rem;
    }

    .tool-card {
      background: white;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }

    .tool-card:hover {
      transform: translateY(-3px);
    }

    .tool-icon {
      font-size: 1.5rem;
      color: #007bff;
      margin-bottom: 1rem;
    }

    .category-title {
      color: #444;
      margin: 2rem 0 1rem;
      padding-left: 1rem;
    }

    /* ÁßªÂä®Á´ØÊ†∑Âºè */
    @media (max-width: 768px) {
      .nav-categories {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        flex-direction: column;
        padding: 1rem;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      }

      .nav-categories.active {
        display: flex;
      }

      .nav-category {
        padding: 0.5rem 0;
        text-decoration: none;
      }

      .menu-btn {
        display: block;
      }

      nav {
        padding: 1rem;
      }
    }
  </style>
  <script src="../static/js/jquery-3.6.2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <!-- Ê∑ªÂä†ÂõæÁâáÂ§ÑÁêÜÊâÄÈúÄÁöÑÂ∫ì -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jimp/0.16.1/jimp.min.js"></script>
  <!-- Google tag (gtag.js2) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8NMLH22Y6G"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-8NMLH22Y6G');
  </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7274710287377352"
          crossorigin="anonymous"></script>
</head>
<body>
<nav>
  <div class="nav-container">
    <div class="logo">
      <a href="../../index.html" class="nav-item">
        <img src="../../static/images/logo.png" width="100px" style="margin-right: 60px"/>
      </a>
    </div>
    <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
    <div class="nav-categories">
      <a href="../../index.html" class="nav-category">üîç Recommended</a>
      <a href="../../life.html" class="nav-category">üè† Life Tools</a>
      <a href="../../encry.html" class="nav-category">üîí Encryption</a>
      <a href="../../code.html" class="nav-category">üìù Encoding</a>
      <a href="../../dev.html" class="nav-category">üíª Dev Tools</a>
      <a href="../../image.html" class="nav-category">üñºÔ∏è Image Tools</a>
      <a href="../../game.html" class="nav-category">üéÆ Fun Tools</a>
    </div>
  </div>
</nav>

<h1 style="text-align: center">Online Image Compressor</h1>
<div class="container">
  <div class="settings">
    <label>
      Scale:
      <input
              type="range"
              id="scaleFactor"
              min="10"
              max="100"
              value="70"
              step="5"
      />
      <span id="scaleValue">70%</span>
      <span class="recommended-tag">Recommended: 70%</span>
    </label>
    <label>
      Quality:
      <input
              type="range"
              id="quality"
              min="10"
              max="100"
              value="70"
              step="5"
      />
      <span id="qualityValue">70%</span>
      <span class="recommended-tag">Recommended: 70%</span>
    </label>
    <label>
      Output format:
      <select id="format">
        <option value="image/jpeg">JPEG</option>
        <option value="image/png">PNG</option>
        <option value="image/webp">WebP</option>
      </select>
    </label>
  </div>

  <div class="upload-area" id="uploadArea">
    <input
            type="file"
            id="upload"
            accept="image/jpeg,image/png,image/webp"
    />
    <div class="upload-content">
      <i>üìÅ</i>
      <div class="upload-text">Drag an image here or click to upload</div>
      <div class="upload-hint">Supports JPG, PNG, WebP up to 10MB</div>
      <div class="error-message" id="errorMessage"></div>
    </div>
  </div>

  <button class="con-btn" onclick="compressImage()">Compress</button>

  <div class="progress-bar">
    <div class="progress" id="progress"></div>
  </div>

  <div class="file-info" id="fileInfo">
    <div>Original size: <span id="originalSize">0 KB</span></div>
    <div>Compressed size: <span id="compressedSize">0 KB</span></div>
    <div>Compression ratio: <span id="compressionRatio">0%</span></div>
  </div>

  <canvas id="canvas" style="display: none"></canvas>
  <a
          id="download"
          style="display: none; margin-top: 10px"
          download="compressed-image.jpg">
    Download compressed image</a>
  <div id="preview"></div>
</div>

<script>
  // Áªü‰∏ÄÂÆö‰πâ DOM ÂÖÉÁ¥†
  const uploadArea = document.getElementById("uploadArea");
  const fileInput = document.getElementById("upload");
  const errorMessage = document.getElementById("errorMessage");
  const progressBar = document.querySelector(".progress-bar");
  const progress = document.getElementById("progress");
  const fileInfo = document.getElementById("fileInfo");
  const scaleFactorInput = document.getElementById("scaleFactor");
  const qualityInput = document.getElementById("quality");
  const scaleValue = document.getElementById("scaleValue");
  const qualityValue = document.getElementById("qualityValue");
  const canvas = document.getElementById("canvas");
  const preview = document.getElementById("preview");
  const downloadLink = document.getElementById("download");

  // ËÆæÁΩÆÊªëÂùóÂÄºÊòæÁ§∫
  scaleFactorInput.addEventListener("input", function (e) {
    scaleValue.textContent = e.target.value + "%";
  });

  qualityInput.addEventListener("input", function (e) {
    qualityValue.textContent = e.target.value + "%";
  });

  // Êñá‰ª∂Â§ßÂ∞èÊ†ºÂºèÂåñ
  function formatFileSize(bytes) {
    if (bytes === 0) return "0 Bytes";
    const k = 1024;
    const sizes = ["Bytes", "KB", "MB", "GB"];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
  }

  // ÊòæÁ§∫ÈîôËØØ‰ø°ÊÅØ
  function showError(message) {
    errorMessage.textContent = message;
    errorMessage.style.display = "block";
    setTimeout(() => {
      errorMessage.style.display = "none";
    }, 3000);
  }

  // Ê∏ÖÁêÜÂáΩÊï∞
  function cleanup() {
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    canvas.width = canvas.height = 0;
    progressBar.style.display = "none";
    progress.style.width = "0%";
  }

  // Êñá‰ª∂ÂêçÊ∏ÖÁêÜ
  function sanitizeFileName(name) {
    return name.replace(/[^a-zA-Z0-9.-]/g, "_").replace(/_{2,}/g, "_");
  }

  // Êñá‰ª∂È™åËØÅ
  function validateFile(file) {
    const validTypes = ["image/jpeg", "image/png", "image/webp"];
    const maxSize = 10 * 1024 * 1024;
    const maxDimension = 4096;

    return new Promise((resolve, reject) => {
      if (!validTypes.includes(file.type)) {
        reject("Please upload a JPG, PNG, or WebP image");
        return;
      }

      if (file.size > maxSize) {
        reject("File size must not exceed 10MB");
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        const arr = new Uint8Array(e.target.result).subarray(0, 4);
        let header = "";
        for (let i = 0; i < arr.length; i++) {
          header += arr[i].toString(16);
        }

        const validHeaders = {
          ffd8ffe0: true,
          "89504e47": true,
          52494646: true,
        };

        if (!validHeaders[header]) {
          reject("Invalid file format");
          return;
        }

        const img = new Image();
        img.onload = function () {
          URL.revokeObjectURL(img.src);
          if (this.width > maxDimension || this.height > maxDimension) {
            reject(`Image dimensions must not exceed ${maxDimension}x${maxDimension}`);
            return;
          }
          resolve(true);
        };
        img.onerror = function () {
          URL.revokeObjectURL(img.src);
          reject("Image failed to load");
        };
        img.src = URL.createObjectURL(file);
      };
      reader.onerror = () => reject("File read failed");
      reader.readAsArrayBuffer(file.slice(0, 4));
    });
  }

  // ÂõæÁâáÂéãÁº©‰∏ªÂáΩÊï∞
  async function compressImage() {
    try {
      if (fileInput.files.length === 0) {
        throw new Error("Please choose an image file");
      }

      const file = fileInput.files[0];
      await validateFile(file);

      document.getElementById("originalSize").textContent = formatFileSize(
              file.size
      );
      fileInfo.style.display = "block";
      progressBar.style.display = "block";

      const loadImage = () =>
              new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                  const img = new Image();
                  img.onload = () => resolve(img);
                  img.onerror = () => reject(new Error("Image failed to load"));
                  img.src = e.target.result;
                };
                reader.onerror = () => reject(new Error("File read failed"));
                reader.readAsDataURL(file);
                setTimeout(() => reject(new Error("Âä†ËΩΩË∂ÖÊó∂")), 30000);
              });

      let progressValue = 0;
      const progressInterval = setInterval(() => {
        progressValue = Math.min(progressValue + 5, 90);
        progress.style.width = progressValue + "%";
      }, 100);

      try {
        const img = await loadImage();
        const ctx = canvas.getContext("2d");

        const scaleFactor = scaleFactorInput.value / 100;
        const quality = qualityInput.value / 100;
        const format = document.getElementById("format").value;

        const maxDimension = 4096;
        let width = img.width * scaleFactor;
        let height = img.height * scaleFactor;

        if (width > maxDimension || height > maxDimension) {
          const ratio = Math.min(
                  maxDimension / width,
                  maxDimension / height
          );
          width *= ratio;
          height *= ratio;
        }

        canvas.width = width;
        canvas.height = height;

        requestAnimationFrame(() => {
          ctx.drawImage(img, 0, 0, width, height);
          const compressedDataUrl = canvas.toDataURL(format, quality);

          const compressedSize = Math.round(
                  ((compressedDataUrl.length - 22) * 3) / 4
          );
          document.getElementById("compressedSize").textContent =
                  formatFileSize(compressedSize);
          const ratio = Math.round((1 - compressedSize / file.size) * 100);
          document.getElementById("compressionRatio").textContent =
                  ratio + "%";

          downloadLink.href = compressedDataUrl;
          const extension = format.split("/")[1];
          const fileName = `compressed-${sanitizeFileName(
                  file.name.split(".")[0]
          )}.${extension}`;
          downloadLink.download = fileName;
          downloadLink.style.display = "block";
          downloadLink.textContent = "Download compressed image";

          preview.innerHTML = `<img src="${compressedDataUrl}" alt="Compressed Image">`;

          clearInterval(progressInterval);
          progress.style.width = "100%";
          setTimeout(() => {
            progressBar.style.display = "none";
            progress.style.width = "0%";
          }, 1000);
        });
      } finally {
        clearInterval(progressInterval);
      }
    } catch (error) {
      cleanup();
      showError(error.message || "An error occurred during compression");
    }
  }

  // ÊãñÊãΩÁõ∏ÂÖ≥‰∫ã‰ª∂Â§ÑÁêÜ
  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  function highlight(e) {
    uploadArea.classList.add("drag-over");
  }

  function unhighlight(e) {
    uploadArea.classList.remove("drag-over");
  }

  // ÁªëÂÆöÊãñÊãΩ‰∫ã‰ª∂
  ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
    uploadArea.addEventListener(eventName, preventDefaults, false);
    document.body.addEventListener(eventName, preventDefaults, false);
  });

  ["dragenter", "dragover"].forEach((eventName) => {
    uploadArea.addEventListener(eventName, highlight, false);
  });

  ["dragleave", "drop"].forEach((eventName) => {
    uploadArea.addEventListener(eventName, unhighlight, false);
  });

  // Â§ÑÁêÜÊñá‰ª∂ÊãñÊîæ
  uploadArea.addEventListener("drop", async (e) => {
    const file = e.dataTransfer.files[0];
    try {
      await validateFile(file);
      const dataTransfer = new DataTransfer();
      dataTransfer.items.add(file);
      fileInput.files = dataTransfer.files;
      compressImage();
    } catch (error) {
      showError(error);
    }
  });

  // Â§ÑÁêÜÊñá‰ª∂ÈÄâÊã©
  fileInput.addEventListener("change", async function (e) {
    const file = e.target.files[0];
    try {
      await validateFile(file);
      compressImage();
    } catch (error) {
      showError(error);
      this.value = "";
    }
  });

  // ÁΩëÁªúÁä∂ÊÄÅÁõëÊéß
  window.addEventListener("online", () => {
    document.querySelector(".upload-hint").style.color = "#888";
    document.querySelector(".upload-hint").textContent =
            "Supports JPG, PNG, WebP up to 10MB";
  });

  window.addEventListener("offline", () => {
    document.querySelector(".upload-hint").style.color = "#ff4444";
    document.querySelector(".upload-hint").textContent = "Network connection lost";
  });
</script>
</body>

<script>
  function toggleMenu() {
    const nav = document.querySelector('.nav-categories');
    nav.classList.toggle('active');

    // ÁÇπÂáªËèúÂçïÈ°πÂêéËá™Âä®ÂÖ≥Èó≠
    document.querySelectorAll('.nav-category').forEach(item => {
      item.addEventListener('click', () => {
        if (window.innerWidth <= 768) {
          nav.classList.remove('active');
        }
      });
    });
  }
</script>



</html>